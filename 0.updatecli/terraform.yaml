name: Upgrade Terraform Provider

scms:
  default:
    kind: github
    spec:
      user: "{{ .github.user }}"
      email: "{{ .github.email }}"
      owner: batleforc
      repository: weebo-si
      token: "{{ requiredEnv .github.token }}"
      username: "{{ .github.username }}"
      branch: main

actions:
  terraform:
    kind: github/pullrequest
    scmid: default
    spec:
      title: 'ci: Bump terraform Provider'
      automerge: false

sources:
  talos:
    kind: terraform/registry
    spec:
      type: provider
      namespace: siderolabs
      name: talos
  proxmox:
    kind: terraform/registry
    spec:
      type: provider
      namespace: bpg
      name: proxmox

targets:
  bumpTalosCapi:
    name: "Update Talos Provider CAPI"
    kind: terraform/provider
    scmid: default
    sourceid: talos
    spec:
      file: capi.terraform/main.tf
      provider: "talos"
  bumpTalosPrepare:
    name: "Update Talos Provider Prepare"
    kind: terraform/provider
    scmid: default
    sourceid: talos
    spec:
      file: 0.terraform/download-iso-talos/main.tf
      provider: "talos"
  bumpProxmoxCapi:
    name: "Update Proxmox Provider CAPI"
    kind: terraform/provider
    scmid: default
    sourceid: proxmox
    spec:
      file: capi.terraform/main.tf
      provider: "proxmox"
  bumpProxmoxPrepare:
    name: "Update Proxmox Provider Prepare"
    kind: terraform/provider
    scmid: default
    sourceid: proxmox
    spec:
      file: 0.terraform/download-iso-talos/main.tf
      provider: "proxmox"
