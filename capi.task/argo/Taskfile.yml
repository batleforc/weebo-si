version: '3'

env:
  KUBECONFIG: "../capi.terraform/kubeconfig"
  ARGO_APP_REPO: "https://github.com/batleforc/weebo-si"
  ARGO_DEST_SERVER: "https://kubernetes.default.svc"
  ARGO_VERSION: "7.8.7"

tasks:
  install:
    cmds:
    - kubectl apply -f ./argo/ns.yaml
    - helm repo add argo https://argoproj.github.io/argo-helm
    - helm upgrade --install argocd argo/argo-cd --namespace argocd --version $ARGO_VERSION
  port-forward:
    cmds:
    - kubectl port-forward svc/argocd-server -n argocd 8080:443
  get-pwd:
    cmds:
    - kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath="{.data.password}" | base64 -d
